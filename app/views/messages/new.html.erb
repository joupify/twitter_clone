<%= turbo_frame_tag "reply_form" do %>
  <h1>New Message</h1>
<%= form_with(model: @message, url: messages_path, data: { turbo: false }) do |form| %>

    <% if params[:parent_id].present? %>
      <% parent_message = Message.find(params[:parent_id]) %>
        <%= form.hidden_field :receiver_id, value: parent_message.sender.id %>
        <div>
          <strong>To:</strong> <%= parent_message.sender.username %>
        </div>
    <% else %>
      <div>
        <%= form.label :receiver_id, 'To:' %>
        <%= form.collection_select :receiver_id, User.where.not(id: current_user.id), :id, :username %>
      </div>
    <% end %>

    <%= form.hidden_field :parent_id, value: params[:parent_id] %>

    <div>
      <%= form.label :content, 'Message:' %>
      <%= form.text_area :content %>
    </div>

    <div>
      <%= form.submit 'Send' %>
    </div>
  <% end %>
<% end %>